<div class="modal-overlay" *ngIf="isVisible" (click)="onCancelClick()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Upload de Arquivo CSV</h3>
      <button type="button" class="close-btn" (click)="onCancelClick()" [disabled]="isUploading">
        <span>&times;</span>
      </button>
    </div>

    <div class="upload-content">
      <!-- Área de Drop/Seleção de Arquivo -->
      <div 
        class="file-drop-area"
        [class.drag-over]="dragOver"
        [class.has-file]="selectedFile"
        [class.has-error]="validationErrors.length > 0"
        (dragover)="onDragOver($event)"
        (dragleave)="onDragLeave($event)"
        (drop)="onDrop($event)"
      >
        <div *ngIf="!selectedFile" class="drop-message">
          <div class="upload-icon">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
              <polyline points="7,10 12,15 17,10"></polyline>
              <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
          </div>
          <p class="primary-text">Arraste e solte seu arquivo CSV aqui</p>
          <p class="secondary-text">ou</p>
          <label for="file-input" class="file-select-btn">
            Selecionar Arquivo
            <input 
              type="file" 
              id="file-input" 
              accept=".csv" 
              (change)="onFileSelected($event)"
              style="display: none;"
            />
          </label>
          <p class="file-info">Apenas arquivos CSV (máximo 10MB)</p>
        </div>

        <!-- Arquivo Selecionado -->
        <div *ngIf="selectedFile" class="selected-file">
          <div class="file-icon">
            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"></path>
            </svg>
          </div>
          <div class="file-details">
            <p class="file-name">{{ selectedFile.name }}</p>
            <p class="file-size">{{ formatFileSize(selectedFile.size) }}</p>
          </div>
          <button 
            type="button" 
            class="remove-file-btn" 
            (click)="removeFile()"
            [disabled]="isUploading"
          >
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        </div>
      </div>

      <!-- Erros de Validação -->
      <div *ngIf="validationErrors.length > 0" class="validation-errors">
        <div class="error-item" *ngFor="let error of validationErrors">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="15" y1="9" x2="9" y2="15"></line>
            <line x1="9" y1="9" x2="15" y2="15"></line>
          </svg>
          {{ error }}
        </div>
      </div>

      <!-- Campo de Observações -->
      <div class="form-group">
        <label for="observacoes">Observações (opcional)</label>
        <textarea
          id="observacoes"
          [(ngModel)]="observacoes"
          class="form-control"
          rows="3"
          placeholder="Adicione observações sobre este arquivo..."
          [disabled]="isUploading"
        ></textarea>
      </div>

      <!-- Barra de Progresso -->
      <div *ngIf="isUploading" class="upload-progress">
        <div class="progress-info">
          <span>Fazendo upload...</span>
          <span>{{ uploadProgress }}%</span>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" [style.width.%]="uploadProgress"></div>
        </div>
      </div>

      <!-- Ações -->
      <div class="form-actions">
        <button
          type="button"
          class="btn btn-secondary"
          (click)="onCancelClick()"
          [disabled]="isUploading"
        >
          {{ isUploading ? 'Cancelar Upload' : 'Cancelar' }}
        </button>
        <button
          type="button"
          class="btn btn-primary"
          (click)="uploadFile()"
          [disabled]="!canUpload"
        >
          <span *ngIf="isUploading" class="loading-spinner"></span>
          {{ isUploading ? 'Enviando...' : 'Fazer Upload' }}
        </button>
      </div>
    </div>
  </div>
</div>
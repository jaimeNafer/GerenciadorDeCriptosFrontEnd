<div class="modal-overlay" *ngIf="isVisible" (click)="onCancelClick()" (keydown.escape)="onCancelClick()" tabindex="0">
  <div class="modal-content" (click)="$event.stopPropagation()" (keydown)="$event.stopPropagation()" tabindex="0">
    <div class="modal-header">
      <h3>{{ isEditMode ? 'Editar Carteira' : 'Nova Carteira' }}</h3>
      <button type="button" class="close-btn" (click)="onCancelClick()">
        <span>&times;</span>
      </button>
    </div>

    <!-- Alert Banner -->
    <div *ngIf="showAlert" class="alert alert-{{ alertType }}" role="alert">
      <span>{{ alertMessage }}</span>
      <button type="button" class="alert-close" (click)="hideAlert()">&times;</button>
    </div>

    <form [formGroup]="carteiraForm" (ngSubmit)="onSubmit()" class="carteira-form">
      <div class="form-group">
        <label for="nome">Nome da Carteira *</label>
        <input
          type="text"
          id="nome"
          formControlName="nome"
          class="form-control"
          [class.error]="nome?.invalid && nome?.touched"
          placeholder="Digite o nome da carteira"
        />
        <div class="error-message" *ngIf="nome?.invalid && nome?.touched">
          <span *ngIf="nome?.errors?.['required']">Nome é obrigatório</span>
          <span *ngIf="nome?.errors?.['minlength']">Nome deve ter pelo menos 3 caracteres</span>
          <span *ngIf="nome?.errors?.['maxlength']">Nome deve ter no máximo 50 caracteres</span>
        </div>
      </div>



      <div class="form-group" *ngIf="!isEditMode">
        <label for="corretoraId">Corretora *</label>
        <select
          id="corretoraId"
          formControlName="corretoraId"
          class="form-control"
          [class.error]="corretoraId?.invalid && corretoraId?.touched"
        >
          <option value="">Selecione uma corretora</option>
          <option *ngFor="let corretora of corretoras" [value]="corretora.id">
            {{ corretora.nome }}
          </option>
        </select>
        <div class="error-message" *ngIf="corretoraId?.invalid && corretoraId?.touched">
          <span *ngIf="corretoraId?.errors?.['required']">Corretora é obrigatória</span>
        </div>
      </div>

      <div class="form-group" *ngIf="isEditMode">
        <label class="checkbox-label">
          <input
            type="checkbox"
            formControlName="excluido"
            class="checkbox"
          />
          <span class="checkmark"></span>
          Carteira excluída
        </label>
      </div>

      <div class="form-actions">
        <button
          type="button"
          class="btn btn-secondary"
          (click)="onCancelClick()"
          [disabled]="isLoading"
        >
          Cancelar
        </button>
        <button
          type="submit"
          class="btn btn-primary"
          [disabled]="carteiraForm.invalid || isLoading"
        >
          <span *ngIf="isLoading" class="loading-spinner"></span>
          {{ isLoading ? 'Salvando...' : (isEditMode ? 'Atualizar' : 'Criar') }}
        </button>
      </div>
    </form>
  </div>
</div>